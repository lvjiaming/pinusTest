"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * This is the tirgger that use an object as trigger.
 */
let SKIP_OLD_JOB = false;
/**
 * The constructor of simple trigger
 */
class SimpleTrigger {
    constructor(trigger, job) {
        this.nextTime = (!!trigger.start) ? trigger.start : Date.now();
        // The rec
        this.period = (!!trigger.period) ? trigger.period : -1;
        // The running count of the job, -1 means no limit
        this.count = (!!trigger.count) ? trigger.count : -1;
        this.job = job;
    }
    /**
     * Get the current excuteTime of rigger
     */
    excuteTime() {
        return this.nextTime;
    }
    /**
     * Get the next excuteTime of the trigger, and set the trigger's excuteTime
     * @return Next excute time
     */
    nextExcuteTime() {
        let period = this.period;
        if ((this.count > 0 && this.count <= this.job.runTime) || period <= 0)
            return null;
        this.nextTime += period;
        if (SKIP_OLD_JOB && this.nextTime < Date.now()) {
            this.nextTime += Math.floor((Date.now() - this.nextTime) / period) * period;
        }
        return this.nextTime;
    }
}
exports.SimpleTrigger = SimpleTrigger;
/**
 * Create Simple trigger
 */
function createTrigger(trigger, job) {
    return new SimpleTrigger(trigger, job);
}
exports.createTrigger = createTrigger;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2ltcGxlVHJpZ2dlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL2xpYi9zaW1wbGVUcmlnZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUE7O0dBRUc7QUFDSCxJQUFJLFlBQVksR0FBRyxLQUFLLENBQUM7QUEwQ3pCOztHQUVHO0FBQ0gsTUFBYSxhQUFhO0lBS3RCLFlBQVksT0FBMEIsRUFBRSxHQUFRO1FBQzVDLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFL0QsVUFBVTtRQUNWLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV2RCxrREFBa0Q7UUFDbEQsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXBELElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBQ25CLENBQUM7SUFFRDs7T0FFRztJQUNILFVBQVU7UUFDTixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDekIsQ0FBQztJQUVEOzs7T0FHRztJQUNILGNBQWM7UUFDVixJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBRXpCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksTUFBTSxJQUFJLENBQUM7WUFDakUsT0FBTyxJQUFJLENBQUM7UUFFaEIsSUFBSSxDQUFDLFFBQVEsSUFBSSxNQUFNLENBQUM7UUFFeEIsSUFBSSxZQUFZLElBQUksSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUU7WUFDNUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUM7U0FDL0U7UUFFRCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDekIsQ0FBQztDQUNKO0FBMUNELHNDQTBDQztBQUNEOztHQUVHO0FBQ0gsU0FBZ0IsYUFBYSxDQUFDLE9BQTBELEVBQUUsR0FBUTtJQUM5RixPQUFPLElBQUksYUFBYSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQztBQUMzQyxDQUFDO0FBRkQsc0NBRUMifQ==